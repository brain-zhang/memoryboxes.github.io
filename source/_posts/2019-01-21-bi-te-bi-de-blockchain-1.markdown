---
layout: post
title: "比特币的blockchain-1"
date: 2019-01-21 17:44:54 +0800
comments: true
categories: blockchain
---

blockchain是个新造词，至少在2008年之前网上是搜索不到这个词的；

比特币的白皮书里面出现过`chain of blocks`的描述，但是没有直接用`block chain`的句子;

在早期bitcointalk.org上面的讨论中，为了方便讨论，早期参与者频繁引用`chain of blocks`的主题，但是谁是最早的引用者，已不可考据。

如果真正要较真blockchain这个单词第一次出现的地方，我想大概是中本聪的第一版bitcoin 源代码中；

bitcoin v0.01源代码中，中本聪第一次在[函数注释中](https://github.com/memoryboxes/bitcoin_satoshi/blob/v0.01/main.h#L596) 完整的引用了`block chain`这个术语，鉴于中本聪在比特币白皮书发表的2年前已经开始编写源码；所以有理由确认：

1. blockchain这个名词是2007-2008年间诞生于世间的
2. 中本聪是比特币之父，比特币是blockchain之母

现在有一种说法，是比特币和区块链是不同的，比特币是个没有什么前途的庞氏货币，而区块链作为一种新兴的基础技术将会在很多领域发扬光大，前景光明；

对于这个说法，我认为Andreas的一场演讲值得一看：

https://www.youtube.com/watch?v=SMEOKDVXlUo

<!-- more -->

好了，八卦完毕，我们开始探究比特币里面的blockchain究竟是个什么样的技术，它是解决什么问题的，实现细节是怎样的；

然后我们一贯的风格是:`光说不练假把式`；在原理说明中，我们会用代码parse真正的比特币区块链文件来一探究竟。

## 由来

还记得我们[之前的文章](https://happy123.me/blog/2018/11/23/bi-te-bi-de-jiao-yi-1/)里面提到的，如果要建立一个分布式的账本，要解决两个问题:

1. 什么样的交易是一笔合法的交易
2. 哪个节点有记账的权力，如何保证整个账本是唯一且不可篡改的

我们在比特币交易的系列文章中解答了第一个问题，现在是解决第二个问题的时候了。

先思考一下货币发行的问题，比特币网络中，会有成千上万的节点参与者，哪些节点能获得发币的权利呢？或者说，凭什么这些节点能发币呢？

人们在金银货币大行其道的时代，发币是通过开采金矿来实现的；采矿者承担了勘探、挖掘的风险，大家认可其开采成果并承认其铸币权；那么映射到电子世界中，能不能有一种类似的挖矿的机制呢？

中本聪的回答就是POW (proof of work--工作量证明)；全网的所有节点一起算一个毫无意义的随机数字，这个数字满足以下的条件，凡是能算出这个数字的人，我们就承认他有一次的记账权：即一次铸币的权利；这个条件如下：

#### 在一个计算周期内，计算出来的这个数字R满足 F(Chain, R) < Diffculty；其中F是SHA256算法，Chain是账本，Diffculty是不断减小的，这意味着寻找R的几率会越来越小

中本聪认为算力是非常公平的、不可伪造的一种证明手段；凡是能在规定周期内正确解答谜题的人，理应获得回报；所有加入到这个比特币网络的人，都应该承认这一点，如果你不承认，那比特币网络就不欢迎你；

那么，铸币的问题解决了；但是如何防止有的节点获取记账权之后，伪造账本呢？

答案是将POW的计算结果嵌入到账本中，每一次新周期的计算，其结果必须在之前所有计算结果的基础上完成；这样如果有人想要伪造账本，他就必须在一个计算周期内伪造更多的账目；如果想要伪造整个账本，就需要将比特币创世之初的所有POW重新计算一遍，而能够获得这样的算力，基本上是不可能的。

那么，如何将这个计算证明过程嵌入到账本里面呢？

答案就是每个计算周期生成一个block，这个block包含了这个周期内全网的交易，然后将block用HASH值作为指针串联起来，构造成一条坚不可摧的chain；这就是blockchain的由来。


## 区块结构

如果你运行bitcond，会发现在数据目录有四类文件:



#### 区块头

#### 标识符

#### 区块高度

#### coinbase

#### 创世区块

#### 隔离见证


## 区块链接成为区块链



## Merkle树

#### SPV(简单支付)
